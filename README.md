# BMW Performance Driving School - Frontend

### Package Name: bmwpds-frontend

This is a repo for the Next app. [See here for the seperate headless Wordpress backend](https://bitbucket.org/studiollc/bmw-performance-driving-school-backend/src/develop/)

## Necessary for development

- Docker Desktop
- Docker Compose
- [StudioLabs Docker Hub](https://bitbucket.org/studiollc/studiolabs-docker-hub/)

## Getting started

The supported way of running the environment for development is Docker Compose.
Make sure you have Docker and Docker Compose installed.

The Docker setup also depends on the StudioLabs Docker Hub.

NOTES:

- it's recommended to setup a shell alias for Docker Compose, eg. `alias dc='docker compose'`
- following commands assume this alias was setup
- under Windows, you'll need to setup and use WSL2 with Docker

First, clone and start [StudioLabs Docker Hub](https://bitbucket.org/studiollc/studiolabs-docker-hub/) by following its readme.

- register these domain alias by following the [Registering domain aliases](https://bitbucket.org/studiollc/studiolabs-docker-hub/src/develop/README.md#markdown-header-registering-domain-aliases) section.
    - `bmwpds.localhost` (frontend app)
    - `bmwpds-cms.localhost` (backend)

Create a `dotenv` file:

- `cp .env.dev.sample .env` (dev environment backend)

> NOTE: instructions above use the dev CMS hosted on WP Engine, but you can also use the local CMS at `http://bmwpds-cms.localhost` - in that case replace the source file in the above commands with `.env.local.sample`.

Then, the following commands will need to be run in the terminal:

- `dc up -d`

Site can be accessed at [http://bmwpds.localhost](http://bmwpds.localhost).

To observe the logs in the terminal:

- `dc logs -f`

To stop the environment:

1. <Ctrl-c>
2. `dc down`

To execute commands (while the container is running):

- `dc exec node <command>`
- eg. `dc exec node npm i -s react-slick --workspace=ui`

> **NOTE:** it's important to install packages this way - if you install them from your host, your host operating systems' node executable will overwrite the lockfile and the `node_modules` folder and it can lead to broken installations.


## Development

We need to run `faust generatePossibleTypes` when we have updated or newly created content types from the backend

- `dc exec node npm run generate`

Before commiting code, run the following to ensure code quality and fix formatting issues. Every pull request will also trigger these checks.

- `npm run lint`
- `npm run test:format` / `npm run format`

## GraphQL, type definitions, codegen

Type definitions for GraphQL queries shouldn't be created manually - this project uses [GraphQL Code Generator](https://www.the-guild.dev/graphql/codegen/docs/getting-started) to automatically generate the definitions from the WpGraphQL API's schema and the queries created under this repo's `./src/__generated__/` folder.

The `graphql-codegen` command is also started in watch mode for `npm run dev` - changes under `./src/` generates new definitions.


## Making commits

This repo is using the [Conventional Changelog](https://www.conventionalcommits.org/) format for git commit messages.

Write commit messages in this format: `<type>(scope): <description>` with `scope` referring to the ticket number e.g. `feat(BMWPDSBLD-20): short commit description`.

See the above documentation for the full list of conventions.


## Organizing the File Directory

Use kebab-case as the naming convention e.g. `components/my-component/my-component.tsx`

##### Auto-generated files

Do not add or modify any files in this directory. Files here are auto-generated by codegen.

```
└── __generated__
    └── ...
```

##### Components

###### Layout

Most components should live here e.g. _header, footer_

Follow this file structure and naming convention:

```
└── components
    └── layout
        ├── my-component-a
        │   ├── my-component-a.tsx
        │   └── index.ts
        ├── my-component-b
        │   ├── my-component-b.tsx
        │   └── index.ts
        └── index.ts
```

###### UI

Components relating to the user interface should live here e.g. _button, form input, modals_

Follow this file structure and naming convention:

```
└── components
    └── ui
        ├── button.tsx
        ├── my-ui-component.tsx
        └── index.ts
```

##### Wordpress Custom Block Components

Naming convention:

- Folder and component name should match `__typename` of the Wordpress block
    - if `__typename: "AcfCustomName"`
    - then `wp-blocks/acf-custom-name/` and `<AcfCustomName />`
- Fragment name should be component name + `Block`
    - `fragment AcfCustomNameBlock on AcfCustomName {...}`

Each block component should follow this structure:

```
└── wp-blocks
    └── acf-custom-name
        ├── config.ts
        ├── template.tsx
        └── index.ts
```

##### WPGraphql Queries

Graphql fragments and queries

```
└── queries
    ├── page-query.ts
    └── menu-queries
        ├── fragments.ts
        ├── footer-menu.ts
        └── header-menu.ts
```

##### Wordpress Templates

This folder works similarly to the [Wordpress template hierarchy system](https://developer.wordpress.org/themes/basics/template-hierarchy/).

The naming convention is analogous to the php templates in Wordpress. Also refer to Faust.js documentation for more in-depth information.

```
└── wp-templates
    ├── index.tsx      // index.php
    ├── front-page.tsx // front-page.php
    ├── page.tsx       // page.php
    └── single.tsx     // single.php
```

## Documentation

- [Faust.js Documentation](https://faustjs.org/docs/)
- [Headless Platform Documentation](https://wpengine.com/headless-wordpress/)
- [WPGraphQL Documentation](https://developers.wpengine.com/docs/atlas/overview/)
